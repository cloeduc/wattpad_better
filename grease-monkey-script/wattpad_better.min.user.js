// ==UserScript==
// @name         Better WattPad
// @namespace    http://cestdoncvrai.fr/
// @version      0.1
// @author       Alinoee
// @match        https://www.wattpad.com/*
// @grant        none
// ==/UserScript==

/*
	START CONFIGURATION
*/
var bw_ENABLE_JUSTIFY = true; // true -> justifie text on fiction // false -> default comportment
var bw_ENABLE_SELECT = true; // true -> enable selection on fiction // false -> default comportment
var bw_ENABLE_COMMENT_IN_BIG = true; // true -> auto-resize comment and other text fields // false -> default comportment (use scroll bar)
var bw_ENABLE_AUTO_LINK = true; // true -> make all links on fiction clikable // false -> default comportment
var bw_INDENT = 0; // 0 : no indentation (default comportement) // 1 : 1em indentation // 2 : 2em indentation ...etc.

/*
	START CORE - DO NOT MODIFIE
*/
// Addlibrary
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var n={exports:{}};t(n.exports,n),e.autosize=n.exports}}(this,function(e,t){"use strict";function n(e){function t(){var t=window.getComputedStyle(e,null);c=t.overflowY,"vertical"===t.resize?e.style.resize="none":"both"===t.resize&&(e.style.resize="horizontal"),f="content-box"===t.boxSizing?-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)):parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth),isNaN(f)&&(f=0),i()}function n(t){var n=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=n,c=t,u&&(e.style.overflowY=t),o()}function o(){var t=window.pageYOffset,n=document.body.scrollTop,o=e.style.height;e.style.height="auto";var i=e.scrollHeight+f;return 0===e.scrollHeight?void(e.style.height=o):(e.style.height=i+"px",v=e.clientWidth,document.documentElement.scrollTop=t,void(document.body.scrollTop=n))}function i(){var t=e.style.height;o();var i=window.getComputedStyle(e,null);if(i.height!==e.style.height?"visible"!==c&&n("visible"):"hidden"!==c&&n("hidden"),t!==e.style.height){var r=document.createEvent("Event");r.initEvent("autosize:resized",!0,!1),e.dispatchEvent(r)}}var d=void 0===arguments[1]?{}:arguments[1],s=d.setOverflowX,l=void 0===s?!0:s,a=d.setOverflowY,u=void 0===a?!0:a;if(e&&e.nodeName&&"TEXTAREA"===e.nodeName&&!r.has(e)){var f=null,c=null,v=e.clientWidth,p=function(){e.clientWidth!==v&&i()},h=function(t){window.removeEventListener("resize",p,!1),e.removeEventListener("input",i,!1),e.removeEventListener("keyup",i,!1),e.removeEventListener("autosize:destroy",h,!1),e.removeEventListener("autosize:update",i,!1),r["delete"](e),Object.keys(t).forEach(function(n){e.style[n]=t[n]})}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",h,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",i,!1),window.addEventListener("resize",p,!1),e.addEventListener("input",i,!1),e.addEventListener("autosize:update",i,!1),r.add(e),l&&(e.style.overflowX="hidden",e.style.wordWrap="break-word"),t()}}function o(e){if(e&&e.nodeName&&"TEXTAREA"===e.nodeName){var t=document.createEvent("Event");t.initEvent("autosize:destroy",!0,!1),e.dispatchEvent(t)}}function i(e){if(e&&e.nodeName&&"TEXTAREA"===e.nodeName){var t=document.createEvent("Event");t.initEvent("autosize:update",!0,!1),e.dispatchEvent(t)}}var r="function"==typeof Set?new Set:function(){var e=[];return{has:function(t){return Boolean(e.indexOf(t)>-1)},add:function(t){e.push(t)},"delete":function(t){e.splice(e.indexOf(t),1)}}}(),d=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?(d=function(e){return e},d.destroy=function(e){return e},d.update=function(e){return e}):(d=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],function(e){return n(e,t)}),e},d.destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],o),e},d.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],i),e}),t.exports=d});
//core
function bw_addStyleOnHead(e,t){var n=document.createElement("style"),a=document.createTextNode(t);n.setAttribute("id",e),n.appendChild(a),document.getElementsByTagName("head")[0].appendChild(n)}function bw_hasClass(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1}function bw_countLink(e,t){var n=new RegExp(t);return e.match(n)?e.match(n).length:0}function bw_urlify(e,t){var n=new RegExp(t);return e.replace(n,function(e){return"<a target='_blank' href='"+e+"'>"+e+"</a>"})}var bw_is_fiction_page=!1,better_wattpad_init=function(e,t){if(e.forEach(function(e){bw_is_fiction_page=bw_hasClass(document.getElementsByTagName("body")[0],"route-storyReading")}),bw_is_fiction_page){if(bw_ENABLE_JUSTIFY&&!document.getElementById("wem_justify")&&bw_addStyleOnHead("wem_justify","#story-reading .page p {text-align:justify}"),bw_INDENT>0&&!document.getElementById("wem_indent")&&bw_addStyleOnHead("wem_indent","#story-reading .page p {text-indent:"+bw_INDENT+"em!important;}"),bw_ENABLE_SELECT)for(var n=document.getElementsByClassName("panel-reading"),a=0;a<n.length;a++)n[a].style.MozUserSelect="text",n[a].style.WebkitUserSelect="text",n[a].style.MsUserSelect="text";if(bw_ENABLE_AUTO_LINK)for(var i=/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi,r=/href="([^\'\"]+)/gi,o=document.getElementsByClassName("panel-reading"),a=0;a<o.length;a++)if("HEADER"!=o[a].nodeName&&"FOOTER"!=o[a].nodeName){var s=bw_countLink(o[a].innerHTML,i);s>0&&s>bw_countLink(o[a].innerHTML,r)&&t&&(t.disconnect(),o[a].innerHTML=bw_urlify(o[a].innerHTML,i),t.observe(document.body,{childList:!0,subtree:!0}))}}bw_ENABLE_COMMENT_IN_BIG&&(autosize(document.querySelectorAll(".message-replies textarea")),autosize(document.querySelectorAll("#commentform textarea")),autosize(document.querySelectorAll("#comments textarea")),autosize(document.querySelectorAll(".activity-feed textarea")))};new MutationObserver(better_wattpad_init).observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["class"]});